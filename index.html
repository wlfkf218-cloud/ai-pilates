<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI í•„ë¼í…ŒìŠ¤ ë£¨í‹´ ê²€ìƒ‰ê¸°</title>
  <style>
    :root{
      --bg:#f6f2ff;
      --bg2:#ffffff;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --line:rgba(31,41,55,.10);
      --accent:#a855f7;   /* lilac */
      --accent2:#fb7185;  /* soft rose */
      --good:#22c55e;
      --danger:#ef4444;
      --shadow: 0 10px 30px rgba(31,41,55,.10);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
      background:
        radial-gradient(900px 600px at 15% 5%, rgba(168,85,247,.18), transparent 55%),
        radial-gradient(900px 600px at 85% 10%, rgba(251,113,133,.14), transparent 60%),
        radial-gradient(900px 600px at 50% 95%, rgba(168,85,247,.10), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 40px}
    header{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:16px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    .title h1{
      margin:0;
      font-size:22px;
      letter-spacing:-.2px;
    }
    .title p{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
    .panel{
      background: rgba(255,255,255,.78);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.72);
    }
    .panel-head h2{
      margin:0;
      font-size:14px;
      letter-spacing:-.1px;
    }
    .panel-body{padding:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .row + .row{margin-top:12px}
    .field{
      display:flex; flex-direction:column; gap:6px; min-width: 180px;
      flex: 1 1 220px;
    }
    label{font-size:12px; color:var(--muted)}
    input[type="text"], input[type="password"], select{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(31,41,55,.10);
      background: rgba(255,255,255,.92);
      color:var(--text);
      outline:none;
    }
    input[type="text"]:focus, input[type="password"]:focus, select:focus{
      border-color: rgba(124,58,237,.7);
      box-shadow: 0 0 0 3px rgba(124,58,237,.18);
    }
    button{
      border:0;
      border-radius: 12px;
      padding:10px 12px;
      background: var(--accent);
      color:white;
      cursor:pointer;
      font-weight:600;
      letter-spacing:-.1px;
      transition: transform .02s ease, opacity .15s ease;
    }
    button:active{transform: scale(.99)}
    button.secondary{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(31,41,55,.10);
      color: var(--text);
      font-weight:600;
    }
    button.danger{
      background: rgba(239,68,68,.95);
    }
    button:disabled{opacity:.55; cursor:not-allowed}
    .pillbar{display:flex; flex-wrap:wrap; gap:8px}
    .pill{
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(168,85,247,.10);
      border:1px solid rgba(31,41,55,.10);
      color: var(--text);
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .pill:hover{border-color: rgba(124,58,237,.55)}
    .pill.on{
      background: rgba(168,85,247,.16);
      border-color: rgba(168,85,247,.45);
    }
    .note{
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
    }
    .status{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(31,41,55,.10);
      background: rgba(255,255,255,.80);
      margin-top:12px;
      min-height:42px;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: rgba(156,163,175,.7);
      box-shadow: 0 0 0 3px rgba(156,163,175,.12);
      flex:0 0 auto;
    }
    .dot.ok{background: rgba(34,197,94,.9); box-shadow: 0 0 0 3px rgba(34,197,94,.16)}
    .dot.bad{background: rgba(239,68,68,.9); box-shadow: 0 0 0 3px rgba(239,68,68,.16)}
    .dot.work{
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(168,85,247,.18);
      animation: pulse 1.1s infinite ease-in-out;
    }
    @keyframes pulse{
      0%{transform:scale(.95); opacity:.7}
      50%{transform:scale(1.12); opacity:1}
      100%{transform:scale(.95); opacity:.7}
    }
    .cards{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 700px){
      .cards{grid-template-columns:1fr}
    }
    .card{
      background: rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: 0 14px 30px rgba(31,41,55,.10);
      display:flex;
      flex-direction:column;
      min-height: 170px;
    }
    .thumb{
      position:relative;
      width:100%;
      aspect-ratio: 16/9;
      background: rgba(255,255,255,.04);
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .badge{
      position:absolute;
      left:10px; top:10px;
      padding:6px 8px;
      border-radius: 999px;
      font-size:12px;
      font-weight:700;
      background: rgba(0,0,0,.5);
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(6px);
    }
    .body{
      padding:12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap:8px;
      flex:1 1 auto;
    }
    .h3{
      margin:0;
      font-size:14px;
      line-height:1.35;
      letter-spacing:-.1px;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      font-size:12px;
      color: var(--muted);
    }
    .desc{
      margin:0;
      color: rgba(229,231,235,.9);
      font-size:12px;
      line-height:1.45;
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .actions{
      margin-top:auto;
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
    }
    .actions .left{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      color: var(--muted);
      font-size:12px;
    }
    .smallbtn{
      padding:9px 10px;
      border-radius: 12px;
      font-size:12px;
      font-weight:800;
      background: var(--accent2);
    }
    footer{
      margin-top:16px;
      padding:14px;
      color:var(--muted);
      border-top:1px solid rgba(255,255,255,.06);
      font-size:12px;
      line-height:1.55;
    }
    .kicker{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top:10px;
    }
    .kbox{
      flex:1 1 240px;
      padding:12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.72);
    }
    .kbox strong{display:block; font-size:12px; color:rgba(229,231,235,.95); margin-bottom:6px}
    .kbox span{font-size:12px; color:var(--muted); line-height:1.45}
    .tiny{
      font-size:11px;
      color: rgba(156,163,175,.95);
      line-height:1.45;
    }
    .divider{height:1px; background: rgba(168,85,247,.10); margin:12px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>AI í•„ë¼í…ŒìŠ¤ ë£¨í‹´ ê²€ìƒ‰ê¸°</h1>
        <p>ì˜¤ëŠ˜ ì»¨ë””ì…˜ì„ ì…ë ¥í•˜ë©´, YouTubeì—ì„œ ë”± ë§ëŠ” í•„ë¼í…ŒìŠ¤ ì˜ìƒì„ ë¶€ë“œëŸ¬ìš´ ì¹´ë“œë¡œ ì¶”ì²œí•´ì¤˜ìš”. (ë£° ê¸°ë°˜ â€œAIì²˜ëŸ¼ ë³´ì´ëŠ”â€ ì¶”ì²œ í¬í•¨)</p>
      </div>
    
      <div style="margin-left:auto; display:flex; align-items:center; gap:10px;">
        <div style="padding:10px 12px; border-radius:999px; border:1px solid var(--line); background: rgba(255,255,255,.70); box-shadow: var(--shadow); font-size:12px; color:var(--muted);">
          ğŸ§˜â€â™€ï¸ Focus â€¢ Balance â€¢ Flow
        </div>
        <svg id="heroArt" width="48" height="48" viewBox="0 0 48 48" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#a855f7" stop-opacity="0.9"/>
              <stop offset="1" stop-color="#fb7185" stop-opacity="0.85"/>
            </linearGradient>
          </defs>
          <circle cx="24" cy="24" r="22" fill="rgba(255,255,255,.65)" stroke="rgba(31,41,55,.10)"/>
          <path d="M24 12c4 5 6 9 6 12 0 4-3 7-6 7s-6-3-6-7c0-3 2-7 6-12z" fill="url(#g1)"/>
          <path d="M12 30c5 3 9 4 12 4s7-1 12-4" fill="none" stroke="rgba(31,41,55,.25)" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>

    </header>

    <div class="grid">
      <!-- ì¢Œì¸¡: ê²€ìƒ‰/ê²°ê³¼ -->
      <section class="panel" aria-label="ê²€ìƒ‰ íŒ¨ë„">
        <div class="panel-head">
          <h2>ê²€ìƒ‰</h2>
          <span class="tiny">YouTube Data API v3</span>
        </div>
        <div class="panel-body">
          <div class="kicker">
            <div class="kbox" id="recommendBox">
              <strong>ì˜¤ëŠ˜ì˜ ì¶”ì²œ í‚¤ì›Œë“œ (ëœë¤ 3ê°œ)</strong>
              <span id="recommendList">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</span>
            </div>
            <div class="kbox">
              <strong>ì…ë ¥ ë¶„ë¥˜(ë£° ê¸°ë°˜)</strong>
              <span id="categoryLine">ì•„ì§ ì…ë ¥ì´ ì—†ì–´ìš”.</span>
            </div>
          </div>

          <div class="divider"></div>

          <div class="row">
            <div class="field" style="flex: 1 1 360px;">
              <label for="q">ì˜¤ëŠ˜ ë‚´ ìƒíƒœ</label>
              <input id="q" type="text" placeholder="ì˜ˆ: í—ˆë¦¬ê°€ ì•„íŒŒì„œ í—ˆë¦¬ ìœ„ì£¼ë¡œ / ê±°ë¶ëª© / ì „ì‹  ìŠ¤íŠ¸ë ˆì¹­" autocomplete="off" />
            </div>

            <div class="field" style="flex: 0 0 140px; min-width: 140px;">
              <label for="order">ì •ë ¬</label>
              <select id="order">
                <option value="relevance">ê´€ë ¨ì„±</option>
                <option value="viewCount">ì¡°íšŒìˆ˜</option>
                <option value="date">ìµœì‹ </option>
              </select>
            </div>

            <div class="field" style="flex: 0 0 170px; min-width: 170px;">
              <label for="dur">ì˜ìƒ ê¸¸ì´</label>
              <select id="dur">
                <option value="any">ì „ì²´</option>
                <option value="shortRange">ì§§ê²Œ (5~15ë¶„)</option>
                <option value="midRange">ì¤‘ê°„ (15~30ë¶„)</option>
                <option value="longRange">ê¸¸ê²Œ (30ë¶„+)</option>
              </select>
            </div>

            <div class="field" style="flex: 0 0 auto; min-width: 140px;">
              <label>&nbsp;</label>
              <button id="searchBtn">ê²€ìƒ‰</button>
            </div>
          </div>

          <div class="row">
            <div class="field" style="flex: 1 1 100%;">
              <label>ì¶”ì²œ íƒœê·¸</label>
              <div class="pillbar" id="tagBar" aria-label="ì¶”ì²œ íƒœê·¸ ë²„íŠ¼ë“¤"></div>
            </div>
          </div>

          <div class="row">
            <div class="field" style="flex: 1 1 100%;">
              <label>ìµœê·¼ ê²€ìƒ‰ì–´ (ìµœëŒ€ 5ê°œ)</label>
              <div class="pillbar" id="recentBar"></div>
            </div>
          </div>

          <div class="status" role="status" aria-live="polite">
            <span class="dot" id="statusDot"></span>
            <div>
              <div id="statusTitle" style="font-weight:700; font-size:12px;">ëŒ€ê¸° ì¤‘</div>
              <div id="statusText" class="tiny">API í‚¤ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
            </div>
          </div>

          <div class="divider"></div>

          <div id="resultTop" class="note"></div>
          <div id="cards" class="cards" aria-label="ê²€ìƒ‰ ê²°ê³¼"></div>

          <footer>
            <strong style="color:rgba(229,231,235,.92)">ì‚¬ìš©ë²•</strong>
            <ol style="margin:8px 0 0 18px; padding:0;">
              <li>ì˜¤ë¥¸ìª½ â€œì„¤ì •â€ì—ì„œ YouTube API Keyë¥¼ ì €ì¥</li>
              <li>â€œì˜¤ëŠ˜ ë‚´ ìƒíƒœâ€ë¥¼ ì…ë ¥í•˜ê³  ê²€ìƒ‰ (ì˜ˆ: <em>í—ˆë¦¬ í†µì¦</em>, <em>ê±°ë¶ëª©</em>)</li>
              <li>ì›í•˜ëŠ” ê¸¸ì´/ì •ë ¬ë¡œ í•„í„°ë§í•˜ê³ , ì˜ìƒ ë³´ê¸° ë²„íŠ¼ìœ¼ë¡œ ìƒˆ íƒ­ì—ì„œ ì¬ìƒ</li>
            </ol>
            <div class="tiny" style="margin-top:10px;">
              âš ï¸ ì°¸ê³ : <span id="runtimeHint">í˜„ì¬ ì‹¤í–‰ í™˜ê²½ì— ë§ëŠ” API í‚¤ ì œí•œ ì•ˆë‚´ë¥¼ ìë™ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.</span>
            </div>
          </footer>
        </div>
      </section>

      <!-- ìš°ì¸¡: ì„¤ì • -->
      <aside class="panel" aria-label="ì„¤ì • íŒ¨ë„">
        <div class="panel-head">
          <h2>ì„¤ì •</h2>
          <span class="tiny">API Key ì €ì¥/ì‚­ì œ</span>
        </div>
        <div class="panel-body">
          <div class="row">
            <div class="field">
              <label for="apiKey">YouTube API Key</label>
              <input id="apiKey" type="password" placeholder="ì—¬ê¸°ì— API í‚¤ë¥¼ ì…ë ¥" autocomplete="off" />
              <div class="tiny">ì €ì¥ ì‹œ localStorageì— ë³´ê´€ë©ë‹ˆë‹¤(ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥).</div>
            </div>
          </div>

          <div class="row">
            <button class="secondary" id="saveKeyBtn">í‚¤ ì €ì¥</button>
            <button class="danger" id="deleteKeyBtn">í‚¤ ì‚­ì œ</button>
          </div>

          <div class="status" style="margin-top:12px;">
            <span class="dot" id="keyDot"></span>
            <div>
              <div id="keyTitle" style="font-weight:700; font-size:12px;">í‚¤ ìƒíƒœ</div>
              <div id="keyText" class="tiny">ì•„ì§ ì €ì¥ëœ í‚¤ê°€ ì—†ì–´ìš”.</div>
            </div>
          </div>

          
          <div class="kbox" style="margin:0 0 12px 0;">
            <strong>í˜„ì¬ ì ‘ì† ì£¼ì†Œ(Origin)</strong>
            <span id="originLine">í™•ì¸ ì¤‘â€¦</span>
            <div class="tiny" style="margin-top:8px" id="referrerHint">Referrer ì œí•œ ì•ˆë‚´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
            <div class="row" style="margin-top:10px">
              <button class="secondary" id="copyUrlBtn" type="button">í˜„ì¬ ì£¼ì†Œ ë³µì‚¬</button>
            </div>
          </div>

          <div class="divider"></div>

          <div class="note">

            <b>ì™œ ë£° ê¸°ë°˜ â€œAIâ€ì¸ê°€ìš”?</b><br/>
            ë³µì¡í•œ AI ëª¨ë¸ ì—†ì´ë„, â€œì…ë ¥ ë¬¸ì¥ â†’ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ â†’ ê²€ìƒ‰ì–´ ë³´ì •â€ ê·œì¹™ì„ ì˜ ë§Œë“¤ë©´
            ì‚¬ìš©ì ì…ì¥ì—ì„œëŠ” AIì²˜ëŸ¼ ë˜‘ë˜‘í•˜ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆì–´ìš”. ë°œí‘œì—ì„œ â€œê·œì¹™(ì‚¬ì „)ì„ ê³„ì† í•™ìŠµì‹œí‚¤ë“¯ í™•ì¥ ê°€ëŠ¥â€ì´ë¼ê³  ì„¤ëª…í•˜ë©´ ì¢‹ì•„ìš”.
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
/**
 * ============================================================
 * 1) ë£°(ì‚¬ì „) ê¸°ë°˜ â€œê²€ìƒ‰ì–´ ë³´ì •â€ + â€œì¹´í…Œê³ ë¦¬ ë¶„ë¥˜â€ ì‚¬ì „ (JSON)
 *    - ë°œí‘œ ë•Œ: "ì‚¬ìš©ì ì…ë ¥ì„ ê·œì¹™ìœ¼ë¡œ í•´ì„í•´ ê²€ìƒ‰ í’ˆì§ˆì„ ì˜¬ë¦°ë‹¤" ë¼ê³  ì„¤ëª… ê°€ëŠ¥
 *    - í•„ìš”í•˜ë©´ ì—¬ê¸°ë§Œ ê³„ì† ì¶”ê°€/ìˆ˜ì •í•˜ë©´ ë¨
 * ============================================================
 */

/** ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ í‚¤ì›Œë“œ(ë£° ê¸°ë°˜) */
const CATEGORY_RULES = [
  { category: "í†µì¦", keywords: ["ì•„í”„", "í†µì¦", "ê²°ë¦¼", "ë­‰ì¹¨", "ì €ë¦¼", "ë»ê·¼", "ì‘¤ì‹¬", "ì—¼ì¢Œ", "ê·¼ìœ¡í†µ", "ë””ìŠ¤í¬", "í˜‘ì°©"] },
  { category: "êµì •", keywords: ["êµì •", "ìì„¸", "ê±°ë¶ëª©", "ë¼ìš´ë“œìˆ„ë”", "ê³¨ë°˜", "ì²™ì¶”", "ì²´í˜•", "í‹€ì–´ì§", "ì •ë ¬"] },
  { category: "ê°•í™”", keywords: ["ê°•í™”", "ê·¼ë ¥", "ì½”ì–´", "í™ì—…", "í•˜ì²´", "ë³µê·¼", "íƒ„íƒ„", "ë°¸ëŸ°ìŠ¤", "ì•ˆì •í™”"] },
  { category: "ìŠ¤íŠ¸ë ˆì¹­", keywords: ["ìŠ¤íŠ¸ë ˆì¹­", "ìœ ì—°", "ì´ì™„", "í’€ê¸°", "ë¦´ë¦¬ì¦ˆ", "ê°€ë™ì„±", "mobility"] },
  { category: "ì´ˆë³´", keywords: ["ì´ˆë³´", "ì…ë¬¸", "ì²˜ìŒ", "ê¸°ì´ˆ", "ì´ˆê¸‰", "beginners", "beginner"] },
];

/**
 * ê²€ìƒ‰ì–´ ë³´ì • ë§¤í•‘(ì‹ ì²´ë¶€ìœ„/ì¦ìƒ â†’ ì¶”ì²œ ê²€ìƒ‰ í‚¤ì›Œë“œ)
 * - key: ì‚¬ìš©ìê°€ ì…ë ¥ì—ì„œ í¬í•¨í•  ìˆ˜ ìˆëŠ” ë‹¨ì–´(ë¶€ë¶„ ì¼ì¹˜)
 * - value: YouTube ê²€ìƒ‰ì— ë” ì˜ ê±¸ë¦¬ëŠ” í™•ì¥ ë¬¸êµ¬
 */
const QUERY_MAP = {
  "í—ˆë¦¬": ["í—ˆë¦¬ í†µì¦ ì™„í™”", "í—ˆë¦¬ ì•ˆì •í™” ì½”ì–´", "í—ˆë¦¬ ë””ìŠ¤í¬ ìš´ë™(ì €ê°•ë„)"],
  "ëª©": ["ëª© í†µì¦ ìŠ¤íŠ¸ë ˆì¹­", "ê±°ë¶ëª© êµì •", "ëª©/ìŠ¹ëª¨ê·¼ ì´ì™„"],
  "ì–´ê¹¨": ["ì–´ê¹¨ ë­‰ì¹¨ í’€ê¸°", "ë¼ìš´ë“œìˆ„ë” êµì •", "ì–´ê¹¨ ê°€ë™ì„± ìŠ¤íŠ¸ë ˆì¹­"],
  "ê³¨ë°˜": ["ê³¨ë°˜ êµì •", "ê³¨ë°˜ ë¹„í‹€ë¦¼ êµì •", "ê³ ê´€ì ˆ ìŠ¤íŠ¸ë ˆì¹­"],
  "ë¬´ë¦": ["ë¬´ë¦ í†µì¦ ì™„í™”(ì €ì¶©ê²©)", "ë¬´ë¦ ì£¼ë³€ ê·¼ë ¥ ê°•í™”", "í•˜ì²´ ì •ë ¬ ìš´ë™"],
  "ì†ëª©": ["ì†ëª© í†µì¦ ì™„í™” ìŠ¤íŠ¸ë ˆì¹­", "ì†ëª© ë³´í˜¸ ìš´ë™", "ì†ëª© ê°€ë™ì„±"],
  "ê±°ë¶ëª©": ["ê±°ë¶ëª© êµì • ìŠ¤íŠ¸ë ˆì¹­", "ëª©/ë“± ìƒë¶€ ìì„¸ êµì •"],
  "ë¼ìš´ë“œìˆ„ë”": ["ë¼ìš´ë“œìˆ„ë” êµì •", "ë“±/í‰ì¶” ìŠ¤íŠ¸ë ˆì¹­"],
  "ì½”ì–´": ["ì½”ì–´ ê°•í™”", "ë³µë¶€ ì•ˆì •í™”", "í•„ë¼í…ŒìŠ¤ ì½”ì–´ ë£¨í‹´"],
  "ì „ì‹ ": ["ì „ì‹  ìŠ¤íŠ¸ë ˆì¹­", "ì „ì‹  ìœ ì‚°ì†Œ+í•„ë¼í…ŒìŠ¤", "ì „ì‹  ìˆœí™˜ ë£¨í‹´"],
  "ìŠ¤íŠ¸ë ˆì¹­": ["ìŠ¤íŠ¸ë ˆì¹­", "ìœ ì—°ì„±", "ì „ì‹  ì´ì™„"],
  "ì´ˆë³´": ["ì´ˆë³´ í•„ë¼í…ŒìŠ¤", "ê¸°ì´ˆ í•„ë¼í…ŒìŠ¤", "ì‰¬ìš´ ë™ì‘"],
};

/** ì¶”ì²œ íƒœê·¸(ë²„íŠ¼) */
const TAGS = [
  { label: "í—ˆë¦¬", value: "í—ˆë¦¬" },
  { label: "ì–´ê¹¨", value: "ì–´ê¹¨" },
  { label: "ëª©", value: "ëª©" },
  { label: "ê³¨ë°˜", value: "ê³¨ë°˜" },
  { label: "ë¬´ë¦", value: "ë¬´ë¦" },
  { label: "ì†ëª©", value: "ì†ëª©" },
  { label: "ì „ì‹ ", value: "ì „ì‹ " },
  { label: "ì½”ì–´", value: "ì½”ì–´" },
  { label: "ìŠ¤íŠ¸ë ˆì¹­", value: "ìŠ¤íŠ¸ë ˆì¹­" },
  { label: "ì´ˆë³´", value: "ì´ˆë³´" },
];

/** ì˜¤ëŠ˜ì˜ ì¶”ì²œ í‚¤ì›Œë“œ í’€(ëœë¤ 3ê°œ) */
const RECOMMEND_POOL = [
  { keyword: "í—ˆë¦¬ í†µì¦ ì™„í™”", reason: "ì¥ì‹œê°„ ì•‰ì•„ìˆëŠ” ì§ì¥ì¸ì—ê²Œ í”í•œ ë¶ˆí¸ í¬ì¸íŠ¸ì˜ˆìš”.", category: "í†µì¦" },
  { keyword: "ê±°ë¶ëª© êµì •", reason: "ìŠ¤ë§ˆíŠ¸í°/ë…¸íŠ¸ë¶ ìì„¸ë¡œ ëª©Â·ì–´ê¹¨ê°€ ì‰½ê²Œ êµ³ì–´ìš”.", category: "êµì •" },
  { keyword: "ê³¨ë°˜ êµì •", reason: "ì¢Œìš° ë°¸ëŸ°ìŠ¤ê°€ ë¬´ë„ˆì§€ë©´ í—ˆë¦¬/ë¬´ë¦ê¹Œì§€ ì˜í–¥ì´ ê°€ìš”.", category: "êµì •" },
  { keyword: "ì½”ì–´ ê°•í™”", reason: "í•„ë¼í…ŒìŠ¤ì˜ í•µì‹¬! ì•ˆì •í™”ê°€ ì¢‹ì•„ì§€ë©´ ìì„¸ê°€ ë‹¬ë¼ì ¸ìš”.", category: "ê°•í™”" },
  { keyword: "ì „ì‹  ìŠ¤íŠ¸ë ˆì¹­", reason: "ì§§ê²Œë¼ë„ ì „ì‹ ì„ í’€ì–´ì£¼ë©´ ì»¨ë””ì…˜ì´ í™• ë‹¬ë¼ì ¸ìš”.", category: "ìŠ¤íŠ¸ë ˆì¹­" },
  { keyword: "ì´ˆë³´ í•„ë¼í…ŒìŠ¤", reason: "ì²˜ìŒì´ë©´ â€˜ì‰¬ìš´ ë£¨í‹´â€™ìœ¼ë¡œ ì„±ê³µ ê²½í—˜ë¶€í„° ë§Œë“¤ì–´ìš”.", category: "ì´ˆë³´" },
  { keyword: "ì–´ê¹¨ ë­‰ì¹¨ í’€ê¸°", reason: "ìŠ¹ëª¨ê·¼ ê¸´ì¥ì„ ë‚®ì¶°ì•¼ ìƒì²´ ì›€ì§ì„ì´ í¸í•´ì ¸ìš”.", category: "í†µì¦" },
  { keyword: "ê³ ê´€ì ˆ ìŠ¤íŠ¸ë ˆì¹­", reason: "ê³¨ë°˜ ì£¼ë³€ì´ ë¶€ë“œëŸ¬ì›Œì§€ë©´ ë™ì‘ì´ í›¨ì”¬ ì¢‹ì•„ì ¸ìš”.", category: "ìŠ¤íŠ¸ë ˆì¹­" },
];

/**
 * ============================================================
 * 2) localStorage í‚¤
 * ============================================================
 */
const LS_API_KEY = "pilatesYT_apiKey_v1";
const LS_RECENTS = "pilatesYT_recentQueries_v1";

/**
 * ============================================================
 * 3) DOM í—¬í¼ (XSS ë°©ì§€: innerHTML ëŒ€ì‹  DOM ìƒì„±)
 * ============================================================
 */
function el(tag, props = {}, children = []) {
  const node = document.createElement(tag);
  for (const [k, v] of Object.entries(props)) {
    if (k === "class") node.className = v;
    else if (k === "text") node.textContent = v;
    else if (k === "href") node.setAttribute("href", v);
    else if (k === "target") node.setAttribute("target", v);
    else if (k === "rel") node.setAttribute("rel", v);
    else if (k.startsWith("on") && typeof v === "function") node.addEventListener(k.slice(2), v);
    else node.setAttribute(k, v);
  }
  for (const c of children) node.appendChild(c);
  return node;
}

function fmtDate(iso) {
  try{
    const d = new Date(iso);
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }catch{ return ""; }
}

/** ISO8601 duration(PT#H#M#S) -> seconds */
function parseISO8601DurationToSec(iso) {
  // ì˜ˆ: PT1H2M3S, PT12M, PT45S
  const m = iso.match(/^PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?$/);
  if (!m) return null;
  const h = parseInt(m[1] || "0", 10);
  const min = parseInt(m[2] || "0", 10);
  const s = parseInt(m[3] || "0", 10);
  return h*3600 + min*60 + s;
}

function fmtDuration(sec){
  if (sec == null) return "";
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = sec % 60;
  if (h > 0) return `${h}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  return `${m}:${String(s).padStart(2,"0")}`;
}

function setStatus(kind, title, text){
  const dot = document.getElementById("statusDot");
  const t = document.getElementById("statusTitle");
  const x = document.getElementById("statusText");

  dot.className = "dot";
  if (kind === "ok") dot.classList.add("ok");
  if (kind === "bad") dot.classList.add("bad");
  if (kind === "work") dot.classList.add("work");

  t.textContent = title;
  x.textContent = text;
}

function setKeyStatus(kind, title, text){
  const dot = document.getElementById("keyDot");
  const t = document.getElementById("keyTitle");
  const x = document.getElementById("keyText");

  dot.className = "dot";
  if (kind === "ok") dot.classList.add("ok");
  if (kind === "bad") dot.classList.add("bad");

  t.textContent = title;
  x.textContent = text;
}

/**
 * ============================================================
 * 4) ì¶”ì²œ í‚¤ì›Œë“œ(ëœë¤ 3ê°œ) ë Œë”
 * ============================================================
 */
function renderTodayRecs(){
  // ë§¤ ìƒˆë¡œê³ ì¹¨ë§ˆë‹¤ ëœë¤ë„ ê´œì°®ì§€ë§Œ, "ì˜¤ëŠ˜" ëŠë‚Œì„ ìœ„í•´ ë‚ ì§œ ê¸°ë°˜ ì‹œë“œ ë¹„ìŠ·í•˜ê²Œ êµ¬í˜„
  const today = new Date();
  const seed = today.getFullYear()*10000 + (today.getMonth()+1)*100 + today.getDate();
  let idx = seed % 9973;

  function nextRand(){
    // ì•„ì£¼ ë‹¨ìˆœí•œ ì˜ì‚¬ë‚œìˆ˜(ì¬í˜„ì„± í™•ë³´ìš©)
    idx = (idx * 9301 + 49297) % 233280;
    return idx / 233280;
  }

  const pool = [...RECOMMEND_POOL];
  const picked = [];
  while (picked.length < 3 && pool.length > 0){
    const r = Math.floor(nextRand() * pool.length);
    picked.push(pool.splice(r,1)[0]);
  }

  const box = document.getElementById("recommendList");
  box.textContent = ""; // ì´ˆê¸°í™”
  const wrap = el("div", { class: "pillbar" });

  for (const p of picked){
    const pill = el("div", { class:"pill", title: "í´ë¦­í•´ì„œ ë°”ë¡œ ê²€ìƒ‰" }, [el("span", { text: p.keyword })]);
    pill.addEventListener("click", () => {
      document.getElementById("q").value = p.keyword;
      updateCategoryLine(p.keyword);
      doSearch();
    });
    wrap.appendChild(pill);

    // ì´ìœ  í•œ ì¤„
    const reason = el("div", { class: "tiny", text: `â€¢ ${p.keyword} â€” ${p.reason}` });
    const line = el("div", {});
    line.appendChild(reason);
    box.appendChild(line);
  }
  // boxì— ì´ìœ ë¥¼ ì—¬ëŸ¬ ì¤„ë¡œ ìŒ“ëŠ” êµ¬ì¡°ë¼ wrap ì‚¬ìš© ì•ˆí•¨. (ìš”êµ¬ì‚¬í•­: ì´ìœ  í•œ ì¤„)
}
renderTodayRecs();

/**
 * ============================================================
 * 5) ìµœê·¼ ê²€ìƒ‰ì–´(localStorage) ê´€ë¦¬
 * ============================================================
 */
function loadRecents(){
  try{
    const raw = localStorage.getItem(LS_RECENTS);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr : [];
  }catch{
    return [];
  }
}

function saveRecent(q){
  const qq = (q || "").trim();
  if (!qq) return;
  const arr = loadRecents();
  const filtered = arr.filter(x => x !== qq);
  filtered.unshift(qq);
  const next = filtered.slice(0, 5);
  localStorage.setItem(LS_RECENTS, JSON.stringify(next));
  renderRecents();
}

function renderRecents(){
  const bar = document.getElementById("recentBar");
  bar.textContent = "";
  const arr = loadRecents();
  if (arr.length === 0){
    bar.appendChild(el("span", { class:"tiny", text:"ì•„ì§ ê²€ìƒ‰ ê¸°ë¡ì´ ì—†ì–´ìš”." }));
    return;
  }
  for (const q of arr){
    const b = el("div", { class:"pill", title:"í´ë¦­í•´ì„œ ë‹¤ì‹œ ê²€ìƒ‰" }, [el("span", { text:q })]);
    b.addEventListener("click", () => {
      document.getElementById("q").value = q;
      updateCategoryLine(q);
      doSearch();
    });
    bar.appendChild(b);
  }
}

/**
 * ============================================================
 * 6) ì¶”ì²œ íƒœê·¸ ë Œë”
 * ============================================================
 */
function renderTags(){
  const bar = document.getElementById("tagBar");
  bar.textContent = "";
  for (const t of TAGS){
    const p = el("div", { class:"pill" }, [el("span", { text:t.label })]);
    p.addEventListener("click", () => {
      // ì…ë ¥ì°½ì— íƒœê·¸ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì¶”ê°€
      const input = document.getElementById("q");
      const cur = input.value.trim();
      if (!cur) input.value = t.value;
      else if (!cur.includes(t.value)) input.value = cur + " " + t.value;
      updateCategoryLine(input.value);
      // ì‹œê°ì ìœ¼ë¡œ í† ê¸€ ëŠë‚Œ
      p.classList.add("on");
      setTimeout(() => p.classList.remove("on"), 180);
      input.focus();
    });
    bar.appendChild(p);
  }
}

/**
 * ============================================================
 * 7) API í‚¤ ì €ì¥/ë¡œë“œ/ì‚­ì œ
 * ============================================================
 */
function loadApiKey(){
  const k = localStorage.getItem(LS_API_KEY);
  return (k || "").trim();
}

function renderKeyState(){
  const k = loadApiKey();
  const keyInput = document.getElementById("apiKey");
  if (k){
    // ë³´ì•ˆìƒ ì „ì²´ë¥¼ ë³´ì—¬ì£¼ì§€ ì•Šê³  ë§ˆìŠ¤í‚¹ ëŠë‚Œë§Œ
    keyInput.value = k;
    setKeyStatus("ok", "í‚¤ ì €ì¥ë¨", "ì´ ë¸Œë¼ìš°ì €ì— API í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆì–´ìš”.");
  }else{
    keyInput.value = "";
    setKeyStatus("bad", "í‚¤ ì—†ìŒ", "API í‚¤ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•´ ì£¼ì„¸ìš”.");
  }
}

document.getElementById("saveKeyBtn").addEventListener("click", () => {
  const v = document.getElementById("apiKey").value.trim();
  if (!v){
    setKeyStatus("bad", "ì €ì¥ ì‹¤íŒ¨", "ë¹ˆ ê°’ì€ ì €ì¥í•  ìˆ˜ ì—†ì–´ìš”.");
    return;
  }
  localStorage.setItem(LS_API_KEY, v);
  renderKeyState();
  setStatus("ok", "ì¤€ë¹„ ì™„ë£Œ", "ì´ì œ ê²€ìƒ‰í•  ìˆ˜ ìˆì–´ìš”.");
});

document.getElementById("deleteKeyBtn").addEventListener("click", () => {
  localStorage.removeItem(LS_API_KEY);
  renderKeyState();
  setStatus("bad", "í‚¤ê°€ ì‚­ì œë¨", "ê²€ìƒ‰í•˜ë ¤ë©´ ë‹¤ì‹œ í‚¤ë¥¼ ì €ì¥í•´ ì£¼ì„¸ìš”.");
});

renderKeyState();
renderTags();
renderRecents();

/**
 * ============================================================
 * 8) ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜(ë£° ê¸°ë°˜) + ê²€ìƒ‰ì–´ ë³´ì •
 * ============================================================
 */
function classifyCategory(input){
  const s = (input || "").toLowerCase();
  for (const r of CATEGORY_RULES){
    for (const kw of r.keywords){
      if (s.includes(kw.toLowerCase())) return r.category;
    }
  }
  // ê¸°ë³¸ê°’: ì…ë ¥ì´ ì—†ê±°ë‚˜ ì• ë§¤í•˜ë©´ ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ìœ ë„
  return s.trim() ? "ìŠ¤íŠ¸ë ˆì¹­" : null;
}

function categoryMessage(category){
  if (!category) return "ì•„ì§ ì…ë ¥ì´ ì—†ì–´ìš”.";
  switch(category){
    case "í†µì¦": return "í†µì¦/ë¶ˆí¸ì´ ëŠê»´ì§€ë©´ â€˜ì €ê°•ë„Â·ì™„í™”Â·ì´ì™„â€™ ì¤‘ì‹¬ìœ¼ë¡œ ì¶”ì²œí•´ìš”.";
    case "êµì •": return "ìì„¸Â·ì²´í˜•ì€ â€˜êµì •/ì •ë ¬/í‰ì¶”Â·ê³ ê´€ì ˆ ê°€ë™ì„±â€™ í‚¤ì›Œë“œê°€ ì˜ ë§ì•„ìš”.";
    case "ê°•í™”": return "ê·¼ë ¥/ì½”ì–´ëŠ” â€˜ì•ˆì •í™”Â·ì½”ì–´ ê°•í™”Â·ë°¸ëŸ°ìŠ¤â€™ ë£¨í‹´ì´ íš¨ê³¼ì ì´ì—ìš”.";
    case "ìŠ¤íŠ¸ë ˆì¹­": return "ë­‰ì¹¨/êµ³ìŒì´ ìˆìœ¼ë©´ â€˜ìŠ¤íŠ¸ë ˆì¹­Â·ì´ì™„Â·ê°€ë™ì„±â€™ìœ¼ë¡œ ì¶”ì²œí•´ìš”.";
    case "ì´ˆë³´": return "ì²˜ìŒì´ë©´ â€˜ê¸°ì´ˆÂ·ì‰¬ìš´ ë™ì‘Â·ì§§ì€ ë£¨í‹´â€™ìœ¼ë¡œ ì‹œì‘í•´ìš”.";
    default: return "ì…ë ¥ì— ë§ì¶° ì¶”ì²œ ë¬¸êµ¬ë¥¼ êµ¬ì„±í–ˆì–´ìš”.";
  }
}

function updateCategoryLine(input){
  const c = classifyCategory(input);
  const line = document.getElementById("categoryLine");
  if (!c){
    line.textContent = "ì•„ì§ ì…ë ¥ì´ ì—†ì–´ìš”.";
    return;
  }
  line.textContent = `ë¶„ë¥˜: ${c} Â· ${categoryMessage(c)}`;
}

function buildSmartQuery(userInput){
  const raw = (userInput || "").trim();
  const category = classifyCategory(raw);

  // ê¸°ë³¸ì ìœ¼ë¡œ "í•„ë¼í…ŒìŠ¤/pilates"ë¥¼ ë¶™ì„
  const baseTokens = [];
  if (raw) baseTokens.push(raw);

  // ë£° ê¸°ë°˜ ë§¤í•‘ìœ¼ë¡œ í™•ì¥ ë¬¸êµ¬ ì¶”ê°€
  // (ì…ë ¥ì— í¬í•¨ëœ í‚¤ë¥¼ ë°œê²¬í•˜ë©´ ëŒ€í‘œ ì¶”ì²œ ë¬¸êµ¬ 1~2ê°œë¥¼ ì¶”ê°€)
  const expansions = [];
  for (const [key, values] of Object.entries(QUERY_MAP)){
    if (raw.includes(key)){
      // ê°€ì¥ ëŒ€í‘œì ì¸ 1ê°œë§Œ ìš°ì„ 
      if (values && values.length) expansions.push(values[0]);
    }
  }

  // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ë³´ì • í‚¤ì›Œë“œ ê°€ì‚°
  const categoryBoost = {
    "í†µì¦": ["ì™„í™”", "ì €ê°•ë„", "ìŠ¤íŠ¸ë ˆì¹­"],
    "êµì •": ["êµì •", "ìì„¸", "ì •ë ¬"],
    "ê°•í™”": ["ê°•í™”", "ì½”ì–´", "ì•ˆì •í™”"],
    "ìŠ¤íŠ¸ë ˆì¹­": ["ìŠ¤íŠ¸ë ˆì¹­", "ì´ì™„", "ê°€ë™ì„±"],
    "ì´ˆë³´": ["ì´ˆë³´", "ê¸°ì´ˆ", "ì‰¬ìš´"],
  };

  const boosts = category ? (categoryBoost[category] || []) : [];
  // ìµœì¢… ì¿¼ë¦¬ êµ¬ì„±: ì‚¬ìš©ì ì…ë ¥ + í™•ì¥ + ë¶€ìŠ¤íŠ¸ + í•„ë¼í…ŒìŠ¤
  const pieces = [];

  if (raw) pieces.push(raw);
  for (const e of expansions.slice(0, 2)) pieces.push(e);
  for (const b of boosts.slice(0, 2)) pieces.push(b);

  // "í•„ë¼í…ŒìŠ¤" + "pilates" ë‘˜ ë‹¤ ë„£ìœ¼ë©´ ê²€ìƒ‰ í­ì´ ë„“ì–´ì§
  pieces.push("í•„ë¼í…ŒìŠ¤");
  pieces.push("pilates");

  // ì¤‘ë³µ ì œê±°
  const dedup = [];
  for (const p of pieces){
    const t = (p || "").trim();
    if (!t) continue;
    if (!dedup.includes(t)) dedup.push(t);
  }

  return { query: dedup.join(" "), category };
}

/**
 * ============================================================
 * 9) YouTube Data API v3 í˜¸ì¶œ
 *    - search.list ë¡œ ì˜ìƒID ëª©ë¡ì„ ì–»ê³ 
 *    - videos.list ë¡œ duration/snippet ë¥¼ ê°€ì ¸ì˜´ (ê¸¸ì´ í•„í„° ìœ„í•´ í•„ìš”)
 * ============================================================
 */
const YT_BASE = "https://www.googleapis.com/youtube/v3";

function buildUrl(path, params){
  const u = new URL(YT_BASE + path);
  for (const [k,v] of Object.entries(params)){
    u.searchParams.set(k, String(v));
  }
  return u.toString();
}

async function ytSearch(apiKey, q, order){
  const url = buildUrl("/search", {
    part: "snippet",
    q,
    type: "video",
    maxResults: 15,
    order,
    safeSearch: "strict",
    key: apiKey
  });

  const res = await fetch(url);
  const data = await res.json();
  if (!res.ok){
    const msg = (data && data.error && data.error.message) ? data.error.message : "ìš”ì²­ ì‹¤íŒ¨";
    const reason = (data && data.error && data.error.errors && data.error.errors[0] && data.error.errors[0].reason) ? data.error.errors[0].reason : "unknown";
    throw new Error(`${msg} (reason: ${reason})`);
  }
  const ids = (data.items || [])
    .map(it => it.id && it.id.videoId)
    .filter(Boolean);
  return ids;
}

async function ytVideos(apiKey, ids){
  if (!ids.length) return [];
  const url = buildUrl("/videos", {
    part: "snippet,contentDetails",
    id: ids.join(","),
    key: apiKey
  });

  const res = await fetch(url);
  const data = await res.json();
  if (!res.ok){
    const msg = (data && data.error && data.error.message) ? data.error.message : "ìš”ì²­ ì‹¤íŒ¨";
    const reason = (data && data.error && data.error.errors && data.error.errors[0] && data.error.errors[0].reason) ? data.error.errors[0].reason : "unknown";
    throw new Error(`${msg} (reason: ${reason})`);
  }
  return data.items || [];
}

/**
 * ê¸¸ì´ í•„í„°: (5~15), (15~30), (30+)
 */
function filterByDuration(items, mode){
  if (mode === "any") return items;

  const min5 = 5 * 60;
  const min15 = 15 * 60;
  const min30 = 30 * 60;

  return items.filter(it => {
    const sec = parseISO8601DurationToSec(it.contentDetails && it.contentDetails.duration);
    if (sec == null) return false;
    if (mode === "shortRange") return sec >= min5 && sec < min15;
    if (mode === "midRange") return sec >= min15 && sec < min30;
    if (mode === "longRange") return sec >= min30;
    return true;
  });
}

/**
 * ============================================================
 * 10) ê²°ê³¼ ë Œë”ë§
 * ============================================================
 */
function clearResults(){
  document.getElementById("cards").textContent = "";
  document.getElementById("resultTop").textContent = "";
}

function renderResults(items, info){
  const cards = document.getElementById("cards");
  cards.textContent = "";

  const top = document.getElementById("resultTop");
  top.textContent = info;

  if (!items.length){
    cards.appendChild(el("div", { class:"note", text:"ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ì–´ìš”. ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”." }));
    return;
  }

  for (const it of items){
    const sn = it.snippet || {};
    const title = sn.title || "";
    const channel = sn.channelTitle || "";
    const publishedAt = sn.publishedAt ? fmtDate(sn.publishedAt) : "";
    const desc = sn.description || "";
    const thumbUrl = (sn.thumbnails && (sn.thumbnails.medium || sn.thumbnails.high || sn.thumbnails.default) && (sn.thumbnails.medium || sn.thumbnails.high || sn.thumbnails.default).url) || "";
    const vid = it.id;
    const durSec = parseISO8601DurationToSec(it.contentDetails && it.contentDetails.duration);
    const durText = durSec != null ? fmtDuration(durSec) : "";

    const card = el("div", { class:"card" });

    const thumb = el("div", { class:"thumb" });
    if (thumbUrl){
      const img = el("img", { src: thumbUrl, alt: title });
      thumb.appendChild(img);
    }
    if (durText){
      thumb.appendChild(el("div", { class:"badge", text: durText }));
    }

    const body = el("div", { class:"body" });
    body.appendChild(el("h3", { class:"h3", text: title }));

    // ìš”êµ¬ì‚¬í•­: ì±„ë„ëª… + ì—…ë¡œë“œì¼ ë°˜ë“œì‹œ í‘œì‹œ
    const meta = el("div", { class:"meta" });
    meta.appendChild(el("span", { text: `ì±„ë„: ${channel}` }));
    if (publishedAt) meta.appendChild(el("span", { text: `ì—…ë¡œë“œ: ${publishedAt}` }));
    body.appendChild(meta);

    if (desc){
      body.appendChild(el("p", { class:"desc", text: desc }));
    }

    const actions = el("div", { class:"actions" });
    const left = el("div", { class:"left" });
    left.appendChild(el("span", { text: "YouTube" }));
    actions.appendChild(left);

    const btn = el("button", { class:"smallbtn", text:"ì˜ìƒ ë³´ê¸°" });
    btn.addEventListener("click", () => {
      const url = `https://www.youtube.com/watch?v=${encodeURIComponent(vid)}`;
      window.open(url, "_blank", "noopener,noreferrer");
    });
    actions.appendChild(btn);

    body.appendChild(actions);

    card.appendChild(thumb);
    card.appendChild(body);
    cards.appendChild(card);
  }
}

/**
 * ============================================================
 * 11) ë©”ì¸ ê²€ìƒ‰ í•¨ìˆ˜
 * ============================================================
 */
async function doSearch(){
  const apiKey = loadApiKey();
  if (!apiKey){
    setStatus("bad", "API í‚¤ê°€ í•„ìš”í•´ìš”", "ì˜¤ë¥¸ìª½ ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ì €ì¥í•œ ë’¤ ê²€ìƒ‰í•´ ì£¼ì„¸ìš”.");
    return;
  }

  const userInput = document.getElementById("q").value.trim();
  if (!userInput){
    setStatus("bad", "ì…ë ¥ì„ í™•ì¸í•´ìš”", "ê²€ìƒ‰í•  ëª¸ ìƒíƒœ(í‚¤ì›Œë“œ)ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
    return;
  }

  updateCategoryLine(userInput);

  const order = document.getElementById("order").value;
  const durMode = document.getElementById("dur").value;

  const { query, category } = buildSmartQuery(userInput);
  const infoLine = `ê²€ìƒ‰ì–´(ë³´ì •ë¨): â€œ${query}â€ Â· ë¶„ë¥˜: ${category}`;

  setStatus("work", "ê²€ìƒ‰ ì¤‘â€¦", "YouTubeì—ì„œ ì˜ìƒì„ ì°¾ê³  ìˆì–´ìš”.");
  clearResults();

  try{
    const ids = await ytSearch(apiKey, query, order);
    if (!ids.length){
      setStatus("ok", "ì™„ë£Œ", "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”. ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ì‹œë„í•´ ë³´ì„¸ìš”.");
      renderResults([], infoLine);
      return;
    }

    const vids = await ytVideos(apiKey, ids);
    // ê¸¸ì´ í•„í„°(ì •ë°€)
    const filtered = filterByDuration(vids, durMode);

    // ìµœê·¼ ê²€ìƒ‰ì–´ ì €ì¥(ì‚¬ìš©ì ì…ë ¥ ê¸°ì¤€)
    saveRecent(userInput);

    setStatus("ok", "ì™„ë£Œ", `ê²°ê³¼ ${filtered.length}ê°œë¥¼ í‘œì‹œí–ˆì–´ìš”.`);
    renderResults(filtered, infoLine);
  }catch(err){
    const msg = String(err && err.message ? err.message : err);
    // ìì£¼ ë°œìƒí•˜ëŠ” ì´ìœ ë¥¼ ì¹œì ˆí•˜ê²Œ ì•ˆë‚´
    let hint = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”.";
    if (msg.includes("quotaExceeded")) hint = "ì¼ì¼ ì¿¼í„°ë¥¼ ì´ˆê³¼í–ˆì–´ìš”(quotaExceeded). ë‚´ì¼ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ìƒˆ í”„ë¡œì íŠ¸/í‚¤ë¥¼ ì‚¬ìš©í•´ ë³´ì„¸ìš”.";
    else if (msg.includes("keyInvalid")) hint = "API í‚¤ê°€ ì˜ëª»ë˜ì—ˆì–´ìš”(keyInvalid). í‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.";
    else if (msg.includes("forbidden") || msg.includes("accessNotConfigured")) hint = "APIê°€ ë¹„í™œì„±í™”ë˜ì—ˆê±°ë‚˜ ì ‘ê·¼ì´ ë§‰í˜”ì–´ìš”. Google Cloud Consoleì—ì„œ YouTube Data API v3 í™œì„±í™” ì—¬ë¶€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.";
    else if (msg.includes("API key not valid") || msg.includes("PERMISSION_DENIED")) hint = "í‚¤ ì œí•œ(ë¦¬í¼ëŸ¬/ë„ë©”ì¸ ì œí•œ) ë•Œë¬¸ì— ë§‰í˜”ì„ ìˆ˜ ìˆì–´ìš”. ë”ë¸”í´ë¦­(file://) ì‹¤í–‰ì´ë¼ë©´ í‚¤ ì œí•œì„ í’€ê±°ë‚˜ localhostì—ì„œ ì—´ì–´ë³´ì„¸ìš”.";
    setStatus("bad", "ì‹¤íŒ¨", hint);
    document.getElementById("resultTop").textContent = `ì—ëŸ¬ ìƒì„¸: ${msg}`;
  }
}

document.getElementById("searchBtn").addEventListener("click", doSearch);
document.getElementById("q").addEventListener("keydown", (e) => {
  if (e.key === "Enter"){
    e.preventDefault();
    doSearch();
  }
});
document.getElementById("q").addEventListener("input", (e) => updateCategoryLine(e.target.value));


/**
 * ============================================================
 * 12) ì‹¤í–‰ í™˜ê²½(Origin) í‘œì‹œ + Referrer ì œí•œ ì•ˆë‚´(ìë™)
 *    - GitHub Pages ë°°í¬ ì‹œ: https://ì•„ì´ë””.github.io/ì €ì¥ì†Œ/ í˜•íƒœë¥¼ ê°ì§€í•´
 *      ì¶”ì²œ Referrer íŒ¨í„´ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
 * ============================================================
 */
function computeOriginInfo(){
  // file:// ì—ì„œëŠ” location.originì´ "null" (ë¬¸ìì—´)ë¡œ ë‚˜ì˜¤ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.
  const origin = location.origin;
  const href = location.href;
  const host = location.host || "";
  const pathname = location.pathname || "";

  const isFile = (origin === "null") || href.startsWith("file:");
  const isLocalhost = /^localhost(:\d+)?$/i.test(host) || /^127\.0\.0\.1(:\d+)?$/.test(host);
  const isGitHubPages = host.endsWith("github.io");

  // GitHub Pages í”„ë¡œì íŠ¸ ì‚¬ì´íŠ¸: https://user.github.io/repo/...
  let repoName = "";
  if (isGitHubPages){
    const parts = pathname.split("/").filter(Boolean); // ["repo", ...]
    if (parts.length >= 1) repoName = parts[0];
  }

  // ì¶”ì²œ referrer íŒ¨í„´ ìƒì„±
  const hints = [];
  if (isFile){
    hints.push("í˜„ì¬ëŠ” file:// ë¡œ ì‹¤í–‰ ì¤‘ì´ë¼, HTTP referrer ì œí•œì„ ê±¸ë©´ API í˜¸ì¶œì´ ë§‰í ìˆ˜ ìˆì–´ìš”.");
    hints.push("ê¶Œì¥: (1) í‚¤ ì œí•œì„ ì ê¹ í•´ì œí•˜ê±°ë‚˜ (2) Live Serverë¡œ http://localhost ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”.");
  } else if (isLocalhost){
    hints.push("í˜„ì¬ëŠ” ë¡œì»¬ ì„œë²„(http://localhost)ë¡œ ì‹¤í–‰ ì¤‘ì´ì—ìš”.");
    hints.push("Referrer ì œí•œì„ ì“´ë‹¤ë©´, í—ˆìš© í•­ëª©ì— ë‹¤ìŒì„ ì¶”ê°€í•´ ë³´ì„¸ìš”:");
    hints.push(`- ${origin}/*`);
  } else if (isGitHubPages){
    hints.push("í˜„ì¬ëŠ” GitHub Pages(https://â€¦github.io)ì—ì„œ ì‹¤í–‰ ì¤‘ì´ì—ìš”.");
    hints.push("Referrer ì œí•œì„ ì“´ë‹¤ë©´, í—ˆìš© í•­ëª©ì— ì•„ë˜ íŒ¨í„´ì„ ì¶”ê°€í•˜ë©´ ì•ˆì „í•˜ê²Œ ì“¸ ìˆ˜ ìˆì–´ìš”:");
    if (repoName){
      hints.push(`- ${origin}/${repoName}/*  (í”„ë¡œì íŠ¸ ì €ì¥ì†Œ ê¸°ì¤€)`);
    } else {
      hints.push(`- ${origin}/*`);
    }
    hints.push("TIP: ì„¤ì •ì„ ë°”ê¾¼ ë’¤ ë°˜ì˜ê¹Œì§€ 1~5ë¶„ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”.");
  } else {
    hints.push("í˜„ì¬ëŠ” ì¼ë°˜ ì›¹ ì£¼ì†Œ(https://â€¦)ì—ì„œ ì‹¤í–‰ ì¤‘ì´ì—ìš”.");
    hints.push("Referrer ì œí•œì„ ì“´ë‹¤ë©´, í—ˆìš© í•­ëª©ì— í˜„ì¬ ì‚¬ì´íŠ¸ ì£¼ì†Œ íŒ¨í„´ì„ ì¶”ê°€í•˜ì„¸ìš”:");
    hints.push(`- ${origin}/*`);
  }

  return {
    origin,
    href,
    isFile,
    isLocalhost,
    isGitHubPages,
    repoName,
    hints
  };
}

function renderOriginInfo(){
  const info = computeOriginInfo();

  const originLine = document.getElementById("originLine");
  const referrerHint = document.getElementById("referrerHint");
  const runtimeHint = document.getElementById("runtimeHint");

  if (originLine){
    // originì´ "null"ì´ë©´ ì‚¬ìš©ìì—ê²Œ ë³´ê¸° ì¢‹ê²Œ í‘œê¸°
    const shown = (info.isFile ? "file:// (ë¡œì»¬ íŒŒì¼ ì‹¤í–‰)" : info.origin);
    originLine.textContent = `Origin: ${shown}`;
  }

  const lines = info.hints.map(t => `â€¢ ${t}`).join("\n");
  if (referrerHint){
    referrerHint.textContent = "";
    // ì¤„ë°”ê¿ˆì´ ë³´ì´ë„ë¡ white-space ì„¤ì • ëŒ€ì‹  <br> ì—†ì´ ì—¬ëŸ¬ spanìœ¼ë¡œ êµ¬ì„±
    const frag = document.createDocumentFragment();
    info.hints.forEach((t) => {
      frag.appendChild(el("div", { class:"tiny", text:`â€¢ ${t}` }));
    });
    referrerHint.appendChild(frag);
  }

  if (runtimeHint){
    // footer ì•ˆë‚´(ì§§ê²Œ)
    if (info.isFile) runtimeHint.textContent = "file:// ì‹¤í–‰ ì¤‘ì´ë©´ Referrer ì œí•œì´ ë§‰í ìˆ˜ ìˆì–´ìš”. Live Server(ë˜ëŠ” localhost)ë¡œ ì—¬ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.";
    else if (info.isGitHubPages && info.repoName) runtimeHint.textContent = `GitHub Pagesë¼ë©´ Referrer í—ˆìš©ì— â€œ${info.origin}/${info.repoName}/*â€ ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
    else runtimeHint.textContent = `Referrer ì œí•œì„ ì“´ë‹¤ë©´ â€œ${info.origin}/*â€ ë¥¼ í—ˆìš© ëª©ë¡ì— ì¶”ê°€í•˜ì„¸ìš”.`;
  }

  const copyBtn = document.getElementById("copyUrlBtn");
  if (copyBtn){
    copyBtn.onclick = async () => {
      try{
        // file:// ì´ë©´ ëª¨ë°”ì¼ ê³µìœ  ê°€ì¹˜ê°€ ë‚®ìœ¼ë‹ˆ hrefë¥¼ ë³µì‚¬í•˜ë˜ ì•ˆë‚´
        await navigator.clipboard.writeText(info.href);
        setStatus("ok", "ë³µì‚¬ ì™„ë£Œ", "í˜„ì¬ ì£¼ì†Œë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”.");
      }catch{
        // clipboard ê¶Œí•œì´ ì—†ìœ¼ë©´ fallback
        const ta = document.createElement("textarea");
        ta.value = info.href;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        setStatus("ok", "ë³µì‚¬ ì™„ë£Œ", "í˜„ì¬ ì£¼ì†Œë¥¼ ë³µì‚¬í–ˆì–´ìš”.");
      }
    };
  }
}

/** ì²« ìƒíƒœ ì•ˆë‚´ */
(function init(){
  renderOriginInfo();
  const hasKey = !!loadApiKey();
  if (hasKey){
    setStatus("ok", "ì¤€ë¹„ ì™„ë£Œ", "ê²€ìƒ‰í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”.");
  }else{
    setStatus("bad", "API í‚¤ í•„ìš”", "ì˜¤ë¥¸ìª½ ì„¤ì •ì—ì„œ YouTube API Keyë¥¼ ì €ì¥í•˜ì„¸ìš”.");
  }
})();
</script>
</body>
</html>
